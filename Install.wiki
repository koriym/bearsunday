#summary インストール

= 導入 =

BEAR.Sundayフレームワークを利用するsandboxアプリケーションのBEAR.Pacakgeパッケージをgit cloneで取得して依存ライブラリを[http://getcomposer.org/ composer]を使って取得します。

== 必要要件 ==
 * PHP 5.4
 * APC

 APCはPHP5.4対応の3.1.10以降を[http://jp.php.net/manual/ja/apc.setup.php インストール]します。


== オプション ==
 * [http://jp.php.net/manual/en/book.xhprof.php xhprof]

= インストール =

[https://github.com/koriym/BEAR.package#installation BEAR.package#installation]を参照してください。

== 環境確認 ==
{{{
$ php scripts/check_env.php 
}}}
必要なphp.iniの状態や、DB接続のテストを行います。


= 実行準備 =

=== php.ini ===
{{{
apc.enable_cli = 1
xhprof.output_dir = /tmp
}}}

※ CLIでテストしない場合やxhprofをインストールしてない場合は必要ありません。

== DB ==

`localhost`に`root/（パスなし)`で接続できる場合は設定不要です。
そうでない場合はIDとパスワードを指定します。二種類の方法があります。

====1) 環境変数で====

下記の変数を設定して、PHPが環境変数を読めるようにphp.iniを設定します。

|| BEAR_DB_ID || ID || 
|| BEAR_DB_PASSWORD || パスワード ||

 Note:php.iniで`$_ENV`を利用可能にするための設定が必要です

例) "root" / "password" を環境変数として~/.bashrcでエクスポート

~/.bashrc 追記

{{{
export BEAR_DB_ID=root
export BEAR_DB_PASSWORD=password
}}}

~/.bashrcでエクスポート
{{{
. ~/.bashrc
}}}


====2) ファイルで =====

`app/sandbox/scripts/config.php`を編集して直接値を指定します。



= テスト =
== テスト環境==

{{{
$ pear config-set auto_discover 1
$ pear install pear.phpunit.de/PHPUnit
$ pear install phpunit/DbUnit
$ pear install phpunit/PHP_Invoker
}}}
 Note: 環境によっては、root として実行しなければならないかもしれません。

== DBの準備 ==
テストを実行するためにsandboxアプリで利用するDBとテスト用のDBを作成します。

シェルスクリプト、または手動で入力します。

=== シェルスクリプトで ===
$ apps/sandbox/scripts/install_db.sh 

=== 手動で ===

blogbearデーターベースを作成

{{{
CREATE DATABASE `blogbear` DEFAULT CHARACTER SET 'utf8';
}}}

postsテーブルを作成
{{{
CREATE TABLE posts (
id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
title VARCHAR(50),
body TEXT,
created DATETIME DEFAULT NULL,
modified DATETIME DEFAULT NULL
);
/* それから、テスト用に記事をいくつか入れておきます。 */
INSERT INTO posts (title,body,created)
VALUES ('タイトル', 'これは、記事の本文です。', NOW());
INSERT INTO posts (title,body,created)
VALUES ('またタイトル', 'そこに本文が続きます。', NOW());
INSERT INTO posts (title,body,created)
VALUES ('タイトルの逆襲', 'こりゃ本当に面白そう！うそ。', NOW());
}}}

=== ユニットテスト用データベースの準備 ===
こちらはテスト毎にセット/破棄されるのでコンテンツを用意しておく必要はありません。

{{{
CREATE DATABASE `blogbeartest` DEFAULT CHARACTER SET 'utf8';
}}}
{{{
CREATE TABLE posts (
id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
title VARCHAR(50),
body TEXT,
created DATETIME DEFAULT NULL,
modified DATETIME DEFAULT NULL
);
}}}



= テスト実行 =
$ phpunit

= sandboxアプリケーション実行 =

BEAR.SundayのアプリケーションはWeb、CLI双方からアクセスできます。
https://github.com/koriym/BEAR.package#buil-in-web-server-for-development をご覧下さい


= トラブルシューティング =

 * `PHP Fatal error:  Uncaught exception 'Zend\Cache\Exception\ExtensionNotLoadedException' with message 'ext/apc is disabled - see 'apc.enabled' and 'apc.enable_cli''`

APCをオンにします。

 * `PDOException: SQLSTATE[HY000] [2002] No such file or directory`

ソケットファイルの場所が正しく指定されていません。`mysqladmin version`(OSXなら`mysqladmin5 version`）で表示されるソケットファイルの場所をPHPのiniファイルで指定します。

{{{
$ mysqladmin version

UNIX socket		/opt/local/var/run/mysql5/mysqld.sock
}}}

※/opt/local/var/run/mysql5/mysqld.sockはmacportsでmysqlをインストールしている場合です。

{{{
pdo_mysql.default_socket= /opt/local/var/run/mysql5/mysqld.sock
mysql.default_socket = /opt/local/var/run/mysql5/mysqld.sock
mysqli.default_socket = /opt/local/var/run/mysql5/mysqld.sock
}}}