#summary 初めてのプル

== テンプレートからリソースを呼び出してみましょう ==

ビュー(PHPスクリプト)から直接リソースを利用してみましょう。
以前つくった挨拶リソースをHTMLから直接利用するにはこうなります。

{{{
<?php
$app = require dirname(dirname(__DIR__)) . '/scripts/instance.php';
$message = $app->resource->get->uri('app://self/first/greeting')->withQuery(['name' => 'BEAR'])->eager->request()->body;
?>
<html>
    <body><?php echo $message;?></body>
</html>
}}}

この *素のPHPスクリプト* はwebドキュメント領域に直接公開して、webクライアントから直接リクエストを受けます。

アプリケーションコントローラー($app)をスクリプトから取得しリソースクライアントをつかってアプリケーションリソースを取り出しています。

 Note: $appはアプリケーションのコントロールに必要なリソースクライントやディペンデヒンシーインジェクター、HTTP出力などアプリケーションの重要な機能をもっています。

== これまでと違うところ ==

これまでリソースをコマンドラインかwebから利用していました。リソースをAPIとしてコマンドラインでの確認やWeb APIとして利用しました。またページリはwebからアクセスしてwebページとして表示されました。どちらにしてもフロントスクリプトがあり、それからリソースがリクエストされ出力されてました。

一方、このスクリプトではリソースが直接利用されています。

== 疑問 ==

MVCでいえばこれはビューからモデルが取得されてる事と同じです。順序が逆になってないでしょうか？これで良いのでしょうか？デザインとロジックが混ざってる、良くないコードとも言えないのでしょうか？

== PULL型アーキテクチャ ==

この表示レイヤから処理を開始し、必要に応じて結果を「プル」するアーキテクチャを[http://ja.wikipedia.org/wiki/Web%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%83%AF%E3%83%BC%E3%82%AF#.E3.83.97.E3.83.83.E3.82.B7.E3.83.A5.E5.9E.8B_vs._.E3.83.97.E3.83.AB.E5.9E.8B プル型アーキテクチャ]といいます。

多くののWeb MVC フレームワークはこの逆の「プッシュ型」です。処理を要求するアクションを実行し、次に結果を出力するためにデータを表示のレイヤに「プッシュ」します。「プル」はその逆です。

 Note: [http://en.wikipedia.org/wiki/Comparison_of_web_application_frameworks Comparison of web application frameworks]には様々なフレームワークのpush/pull分類がわかります。

またこのBEAR.Sundayの「リソースプル」はPHPのコードでリソースをプルしていますが、ドメインロジック、コントロールロジックなどのロジックがこのビューに紛れ込んでるわけではありません。あくまでリソースのプレースフォルダ(`<?php echo $message;?>`)とそのリソースをバインドしてるだけす。

== APIとしてリソースを使う ==

このPHPスクリプトはBEAR.Sundayフレームワークを利用していますが、利用はされていません。主がこのスクリプトで、直接リソースを呼び出して利用しています。

それにはリソースクライアントを取得しリクエストするだけです。準備なしにこれだけでリソースを使う事ができます。HTTPを介する事なくAPIとして、他のCMSやフレームワークのPHPプログラムからリソースを利用できます。

 Note: HTTP越しにしたりThrift等の多言語フレームワークを使う事で更にポータビリティは高まります。ドキュメントDB、クライアントサイドMVC、モバイルデバイス、SNSアプリ等... 今日の多様化するアプリケーションに対してAPIをコアにアプリケーションを構築する事は大きな意味があります。